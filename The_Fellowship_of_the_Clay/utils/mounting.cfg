#define TFotC_MOUNTING
	[event]
		name=post advance
		first_time_only=no
		[filter]
			id=Clyde
		[/filter]
		[if]
			[variable]
				name=mounted
				equals=0
			[/variable]
			[then]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_clyde
					mode=replace
					kill=no
				[/store_unit]
			[/then]
			[else]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_mounted
					mode=replace
					kill=no
				[/store_unit]
			[/else]
		[/if]
	[/event]
	[event]
		name=mounting_menu
		first_time_only=no
		[set_menu_item]
			id=mounting
			description=_"mount Snow-White"
			[show_if]
				[have_unit]
					id=Clyde
					[filter_location]
						[filter]
							id="Snow White"
						[/filter]
						radius=1
					[/filter_location]
				[/have_unit]
			[/show_if]
			[filter_location]
				[filter]
					id=Clyde,Snow White
				[/filter]
			[/filter_location]
			[command]
				[store_unit]
					[filter]
						id="Snow White"
					[/filter]
					variable=stored_horse
					mode=replace
				[/store_unit]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_clyde
					kill=yes
					mode=replace
				[/store_unit]
				[hide_unit]
					id="Snow White"
				[/hide_unit]
				[kill]
					id="Snow White"
					animate=no
				[/kill]
				[switch]
					variable=stored_clyde.type
					[case]
						value=Knight of the Light
						[set_variable]
							name=mclyde_type
							value=Mounted Knight of the Light
						[/set_variable]
					[/case]
					[case]
						value=White Knight of the Light
						[set_variable]
							name=mclyde_type
							value=Mounted White Knight of the Light
						[/set_variable]
					[/case]
					[case]
						value=Bright White Knight of the Light
						[set_variable]
							name=mclyde_type
							value=Mounted Bright White Knight of the Light
						[/set_variable]
					[/case]
				[/switch]
				[if]
					[not]
						[variable]
							name=stored_mounted.max_moves
							greater_than_equal_to=7
						[/variable]
					[/not]
					[then]
						[set_variable]
							name=stored_mounted.max_moves
							value=7
						[/set_variable]
					[/then]
				[/if]
				[unit]
					side=1
					type=$mclyde_type
					canrecruit=yes
					id=Clyde
					name= _ "Mounted Clyde"
					experience=$stored_clyde.experience
					x=$stored_horse.x
					y=$stored_horse.y
					facing=$stored_horse.facing
					max_moves=stored_mounted.max_moves
					role=$stored_clyde.role
					overlays=$stored_clyde.overlays
					[modifications]
						{TRAIT_FEARLESS}
					[/modifications]
					[switch]
						variable=stored_clyde.level
						[case]
							value=2
							[abilities]
								{ABILITY_INSPIRE_LEVEL_2}
								{ABILITY_HEALS}
								{ABILITY_REGENERATES4}
								{ABILITY_UNPOISON}
							[/abilities]
						[/case]
						[case]
							value=3
							[abilities]
								{ABILITY_INSPIRE_LEVEL_3}
								{ABILITY_HEALS}
								{ABILITY_REGENERATES4}
								{ABILITY_UNPOISON}
							[/abilities]
						[/case]
						[case]
							value=4
							[abilities]
								{ABILITY_INSPIRE_LEVEL_4}
								{ABILITY_HEALS}
								{ABILITY_REGENERATES4}
								{ABILITY_UNPOISON}
							[/abilities]
						[/case]
					[/switch]
				[/unit]
				[modify_unit]
					[filter]
						id=Clyde
					[/filter]
					moves="$($stored_horse.moves-2)"
					[if]
						[variable]
							name=illuminates
							equals="1"
						[/variable]
						[then]
							halo=halo/illuminates-aura.png
						[/then]
					[/if]
				[/modify_unit]
				[if]
					[variable]
						name=illuminates
						equals="1"
					[/variable]
					[then]
						[object]
							silent=yes
							duration=forever
							[filter]
								side=1
								id=Clyde
							[/filter]
							[effect]
								apply_to=new_ability
								[abilities]
									{ABILITY_ILLUMINATES}
								[/abilities]
							[/effect]
						[/object]
						[modify_unit]
							[filter]
								id=Clyde
							[/filter]
							halo=halo/illuminates-aura.png
						[/modify_unit]
					[/then]
				[/if]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_mounted
					mode=replace
					kill=no
				[/store_unit]
				[if]
					[not]
						[variable]
							name=stored_mounted.max_hitpoints
							greater_than_equal_to=60
						[/variable]
					[/not]
					[then]
						[set_variable]
							name=stored_mounted.max_hitpoints
							value=$stored_clyde.max_hitpoints
							add=5
						[/set_variable]
					[/then]
				[/if]
				[set_variable]
					name=together_maxHP
					value=$stored_clyde.max_hitpoints
					add=$stored_horse.max_hitpoints
				[/set_variable]
				[set_variable]
					name=together_HP
					value=$stored_clyde.hitpoints
					add=$stored_horse.hitpoints
				[/set_variable]
				[set_variable]
					name=together_percent
					value=$together_HP
					divide=$together_maxHP
				[/set_variable]
				[set_variable]
					name=mclyde_HP
					value=$stored_mounted.max_hitpoints
					multiply=$together_percent
				[/set_variable]
				[modify_unit]
					[filter]
						id=Clyde
					[/filter]
					hitpoints=$mclyde_HP
					attacks_left=$stored_clyde.attacks_left
				[/modify_unit]
				[set_variable]
					name=mounted
					value=1
				[/set_variable]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_mounted
					mode=replace
					kill=no
				[/store_unit]
			[/command]
		[/set_menu_item]
	[/event]
	[event]
		name=start
		[fire_event]
			name=mounting_menu
		[/fire_event]
	[/event]
	[event]
		name=moveto
		[fire_event]
			name=mounting_menu
		[/fire_event]
		[allow_undo]
		[/allow_undo]
	[/event]
#enddef
#define TFotC_DISMOUNTING
	[event]
		name=preload
		first_time_only=no
		[set_menu_item]
			id=dismount
			description= _ "dismount Snow-White"
			[show_if]
				[variable]
					name=mounted
					equals=1
				[/variable]
			[/show_if]
			[filter_location]
				[filter]
					id=Clyde
				[/filter]
				radius=1
				[not]
					terrain="Xv,Xu,Wo,Mm^Xm,Md^Xm,Qxu,Ql,Qlf"
				[/not]
			[/filter_location]
			[command]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_mounted
					kill=yes
					mode=replace
				[/store_unit]
				[set_variable]
					name=mounted_percent
					value=$stored_mounted.hitpoints
					divide=$stored_mounted.max_hitpoints
				[/set_variable]
				[set_variable]
					name=stored_horse.hitpoints
					value=$mounted_percent
					multiply=$stored_horse.max_hitpoints
				[/set_variable]
				[set_variable]
					name=stored_clyde.hitpoints
					value=$mounted_percent
					multiply=$stored_clyde.max_hitpoints
				[/set_variable]
				[unstore_unit]
					variable=stored_horse
					find_vacant=yes
					x,y=$stored_mounted.x,$stored_mounted.y
				[/unstore_unit]
				[switch]
					variable=stored_mounted.type
					[case]
						value="Mounted Knight of the Light"
						[set_variable]
							name=clyde_type
							value="Knight of the Light"
						[/set_variable]
					[/case]
					[case]
						value="Mounted White Knight of the Light"
						[set_variable]
							name=clyde_type
							value="White Knight of the Light"
						[/set_variable]
					[/case]
					[case]
						value="Mounted Bright White Knight of the Light"
						[set_variable]
							name=clyde_type
							value="Bright White Knight of the Light"
						[/set_variable]
					[/case]
				[/switch]
				[unit]
					side=1
					id=Clyde
					type=$clyde_type
					name= _ "Clyde"
					x=$x1
					y=$y1
					canrecruit=yes
					experience=$stored_mounted.experience
					moves=0
					attacks_left=$stored_mounted.attacks_left
					role=$stored_mounted.role
					overlays=$stored_mounted.overlays
					[modifications]
						{TRAIT_FEARLESS}
					[/modifications]
				[/unit]
				[if]
					[variable]
						name=illuminates
						equals="1"
					[/variable]
					[then]
						[object]
							silent=yes
							duration=forever
							[filter]
								side=1
								id=Clyde
							[/filter]
							[effect]
								apply_to=new_ability
								[abilities]
									{ABILITY_ILLUMINATES}
								[/abilities]
							[/effect]
						[/object]
						[modify_unit]
							[filter]
								id=Clyde
							[/filter]
							halo=halo/illuminates-aura.png
						[/modify_unit]
					[/then]
				[/if]
				[modify_unit]
					[filter]
						id="Snow White"
					[/filter]
					moves="$($stored_mounted.moves-1)"
					hitpoints=$stored_horse.hitpoints
					attacks_left=$stored_mounted.attacks_left
				[/modify_unit]
				[modify_unit]
					[filter]
						id=Clyde
					[/filter]
					hitpoints=$stored_clyde.hitpoints
				[/modify_unit]
				[set_variable]
					name=mounted
					value=0
				[/set_variable]
			[/command]
		[/set_menu_item]
	[/event]
#enddef
#define TFotC_DISMOUNTING_NOPERCENT   ## this isn't used yet and being worked on
	[event]
		name=moveto
		first_time_only=no
		[filter]
			id=Clyde
		[/filter]
		[filter_condition]
			[variable]
				name=mounted
				numerical_equals=1
			[/variable]
		[/filter_condition]
		[store_unit]
			[filter]
				id=Clyde
			[/filter]
			variable=stored_clyde
			kill=no
			mode=replace
		[/store_unit]
	[/event]
	[event]
		name=post_advance
		[filter_condition]
			[variable]
				name=mounted
				numerical_equals=1
			[/variable]
		[/filter_condition]
		[store_unit]
			[filter]
				id=Clyde
			[/filter]
			variable=stored_mounted
			mode=replace
			kill=no
		[/store_unit]
	[/event]
	[event]
		name=preload
		first_time_only=no
		[set_menu_item]
			id=dismount
			description= _ "dismount Snow-White"
			[show_if]
				[have_unit]
					id=Clyde
					type=Mounted Knight of the Light
				[/have_unit]
				[or]
					[have_unit]
						type=Mounted White Knight of the Light
						id=Clyde
					[/have_unit]
				[/or]
				[or]
					[have_unit]
						type=Mounted Bright White Knight of the Light
						id=Clyde
					[/have_unit]
				[/or]
				[and]
					[variable]
						name=mounted
						equals=1
					[/variable]
				[/and]
			[/show_if]
			[filter_location]
				[not]
					[filter]
						id=Clyde
					[/filter]
				[/not]
				[and]
					[not]
						terrain="Xv,Xu,Wo,Mm^Xm,Md^Xm,Qxu,Ql,Qlf"
					[/not]
				[/and]
				[and]
					x,y=$stored_clyde.x,$stored_clyde.y
					radius=1
				[/and]
			[/filter_location]
			[command]
				[store_unit]
					[filter]
						id=Clyde
					[/filter]
					variable=stored_mounted
					kill=yes
					mode=replace
				[/store_unit]
				[set_variable]
					name=hp_change
					value=$mclyde_hp
					sub=$stored_mounted.hitpoints
					divide=2
				[/set_variable]
				[set_variable]
					name=stored_clyde.hitpoints
					value=$mounted_percent
					multiply=$stored_clyde.max_hitpoints
				[/set_variable]
				[unstore_unit]
					variable=stored_horse
					find_vacant=yes
					x,y=$stored_mounted.x,$stored_mounted.y
				[/unstore_unit]
				[switch]
					variable=stored_mounted.type
					[case]
						value="Mounted Knight of the Light"
						[set_variable]
							name=clyde_type
							value="Knight of the Light"
						[/set_variable]
					[/case]
					[case]
						value="Mounted White Knight of the Light"
						[set_variable]
							name=clyde_type
							value="White Knight of the Light"
						[/set_variable]
					[/case]
					[case]
						value="Mounted Bright White Knight of the Light"
						[set_variable]
							name=clyde_type
							value="Bright White Knight of the Light"
						[/set_variable]
					[/case]
				[/switch]
				[unit]
					side=1
					id=Clyde
					type=$clyde_type
					name= _ "Clyde"
					x=$x1
					y=$y1
					canrecruit=yes
					experience=$stored_mounted.experience
					moves=0
					attacks_left=$stored_mounted.attacks_left
					[modifications]
						{TRAIT_FEARLESS}
					[/modifications]
				[/unit]
				[modify_unit]
					[filter]
						id="Snow White"
					[/filter]
					moves="$($stored_mounted.moves-1)"
					hitpoints=$stored_horse.hitpoints
					attacks_left=$stored_mounted.attacks_left
				[/modify_unit]
				[modify_unit]
					[filter]
						id=Clyde
					[/filter]
					hitpoints=$stored_clyde.hitpoints
				[/modify_unit]
				[set_variable]
					name=mounted
					value=0
				[/set_variable]
			[/command]
		[/set_menu_item]
	[/event]
#enddef
#define ILLUMINATING
[event]
	name=start
	[event]
		name=illuminates_on
		first_time_only=no
		[object]
			silent=yes
			duration=forever
			[filter]
				side=1
				id=Clyde
			[/filter]
			[effect]
				apply_to=new_ability
				[abilities]
					{ABILITY_ILLUMINATES}
				[/abilities]
			[/effect]
		[/object]
		[modify_unit]
			[filter]
				id=Clyde
			[/filter]
			halo=halo/illuminates-aura.png
		[/modify_unit]
		[set_variable]
			name=illuminates
			value=1
		[/set_variable]
	[/event]
	[event]
		name=illuminates_off
		first_time_only=no
		[object]
			silent=yes
			duration=forever
			[filter]
				side=1
				id=Clyde
			[/filter]
			[effect]
				apply_to=remove_ability
				[abilities]
					{ABILITY_ILLUMINATES}
				[/abilities]
			[/effect]
		[/object]
		[modify_unit]
			[filter]
				id=Clyde
			[/filter]
			halo=""
		[/modify_unit]
		[set_variable]
			name=illuminates
			value=0
		[/set_variable]
	[/event]
[/event]
	[event]
		name=preload
		first_time_only=no
		[set_menu_item]
			id=illuminates_on
			description= _ "switch on illuminating"
			[show_if]
				[variable]
					name=illuminates
					numerical_equals=0
				[/variable]
				[and]
					[variable]
						name=illuminates_able
						numerical_equals=1
					[/variable]
				[/and]
			[/show_if]
			[command]
				[fire_event]
					name=illuminates_on
				[/fire_event]
			[/command]
		[/set_menu_item]
		[set_menu_item]
			id=illuminates_off
			description= _ "switch off illuminating"
			[show_if]
				[variable]
					name=illuminates
					numerical_equals=1
				[/variable]
				[and]
					[variable]
						name=illuminates_able
						numerical_equals=1
					[/variable]
				[/and]
			[/show_if]
			[command]
				[fire_event]
					name=illuminates_off
				[/fire_event]
			[/command]
		[/set_menu_item]
	[/event]
	[event]
		name=post advance
		first_time_only=no
		[filter]
			id=Clyde
		[/filter]
		[filter_condition]
			[variable]
				name=illuminates
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=mounted
					numerical_equals=0
				[/variable]
			[/and]
		[/filter_condition]
		[modify_unit]
			[filter]
				id=Clyde
			[/filter]
			halo=halo/illuminates-aura.png
		[/modify_unit]
	[/event]
#enddef
#define TFotC_MOUNTING_FEYNDWARF
	[event]
		name=post advance
		first_time_only=no
		[filter]
			id=Feyndwarf
		[/filter]
		[if]
			[variable]
				name=mounted
				equals=0
			[/variable]
			[then]
				[store_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					variable=stored_feyndwarf
					mode=replace
					kill=no
				[/store_unit]
			[/then]
			[else]
				[store_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					variable=stored_mfeyn
					mode=replace
					kill=no
				[/store_unit]
			[/else]
		[/if]
	[/event]
	[event]
		name=start
		[set_menu_item]
			id=mounting_feyn
			description=_"mount Richard"
			[show_if]
				[have_unit]
					id=Feyndwarf
					[filter_adjecent]
						id=Richard
					[/filter_adjecent]
				[/have_unit]
			[/show_if]
			[filter_location]
				[filter]
					id=Feyndwarf,Richard
				[/filter]
			[/filter_location]
			[command]
				[store_unit]
					[filter]
						id=Richard
					[/filter]
					variable=stored_richard
					mode=replace
					kill=no
				[/store_unit]
				[store_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					variable=stored_feyndwarf
					kill=yes
					mode=replace
				[/store_unit]
				[if]
					[not]
						[variable]
							name=stored_mfeyn.max_hitpoints
							greater_then_equal_to=52
						[/variable]
					[/not]
					[then]
						[set_variable]
							name=stored_mfeyn.max_hitpoints
							value=52
						[/set_variable]
					[/then]
				[/if]
				[hide_unit]
					id=Richard
				[/hide_unit]
				[kill]
					id=Richard
					animate=no
				[/kill]
				[switch]
					variable=stored_feyndwarf.type
					[case]
						value=Dwarvish Runesmith TFotC
						[set_variable]
							name=mfeyn_type
							value="Mounted Runesmith"
						[/set_variable]
					[/case]
					[case]
						value=Dwarvish Runemaster TFotC
						[set_variable]
							name=mfeyn_type
							value="Mounted Runemaster"
						[/set_variable]
					[/case]
					[case]
						value=Dwarvish Arcanister TFotC
						[set_variable]
							name=mfeyn_type
							value="Mounted Arcanister"
						[/set_variable]
					[/case]
				[/switch]
				[unit]
					side=1
					type=$mfeyn_type
					id=Feyndwarf
					name= _ "Mounted Feyndwarf"
					unrenamable=yes
					experience=$stored_feyndwarf.experience
					x=$stored_richard.x
					y=$stored_richard.y
					facing=$stored_richard.facing
					max_moves=stored_richard.max_moves
					max_hitpoints="$($stored_feyndwarf.max_hitpoints+12)"
					role=$stored_feyndwarf.role
					overlays=$stored_stored_feyndwarf.overlays
					{IS_HERO}
				[/unit]
				[modify_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					moves="$($stored_richard.moves-2)"
				[/modify_unit]
				[store_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					variable=stored_mfeyn
					mode=replace
					kill=no
				[/store_unit]
				[set_variable]
					name=feyn_together_maxHP
					value=$stored_feyndwarf.max_hitpoints
					add=$stored_richard.max_hitpoints
				[/set_variable]
				[set_variable]
					name=feyn_together_HP
					value=$stored_feyndwarf.hitpoints
					add=$stored_richard.hitpoints
				[/set_variable]
				[set_variable]
					name=feyn_together_percent
					value=$feyn_together_HP
					divide=$feyn_together_maxHP
				[/set_variable]
				[set_variable]
					name=mfeyn_HP
					value=$stored_mfeyn.max_hitpoints
					multiply=$feyn_together_percent
				[/set_variable]
				[modify_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					hitpoints=$mfeyn_HP
					attacks_left=$stored_feyndwarf.attacks_left
				[/modify_unit]
				[set_variable]
					name=mounted_feyn
					value=1
				[/set_variable]
			[/command]
		[/set_menu_item]
	[/event]
#enddef
#define TFotC_DISMOUNTING_FEYNDWARF
	[event]
		name=start
		[set_menu_item]
			id=dismount_feyn
			description= _ "dismount Richard"
			[show_if]
				[variable]
					name=mounted_feyn
					equals=1
				[/variable]
			[/show_if]
			[filter_location]
				[filter]
					id=Feyndwarf
				[/filter]
				radius=1
				[not]
					terrain="Xv,Xu,Wo,Mm^Xm,Md^Xm,Qxu,Ql,Qlf"
				[/not]
			[/filter_location]
			[command]
				[store_unit]
					[filter]
						id=Feyndwarf
					[/filter]
					variable=stored_mfeyn
					kill=yes
					mode=replace
				[/store_unit]
				[set_variable]
					name=feyn_mounted_percent
					value=$stored_mfeyn.hitpoints
					divide=$stored_mfeyn.max_hitpoints
				[/set_variable]
				[set_variable]
					name=stored_richard.hitpoints
					value=$feyn_mounted_percent
					multiply=$stored_richard.max_hitpoints
				[/set_variable]
				[set_variable]
					name=mfeyn_hitpoints
					value=$feyn_mounted_percent
					multiply=$stored_feyndwarf.max_hitpoints
				[/set_variable]
				[unstore_unit]
					variable=stored_richard
					find_vacant=yes
					x,y=$stored_mfeyn.x,$stored_mfeyn.y
				[/unstore_unit]
				[switch]
					variable=stored_mfeyn.type
					[case]
						value="Mounted Runesmith"
						[set_variable]
							name=feyn_type
							value="Dwarvish Runesmith TFotC"
						[/set_variable]
					[/case]
					[case]
						value="Mounted Runemaster"
						[set_variable]
							name=feyn_type
							value="Dwarvish Runemaster TFotC"
						[/set_variable]
					[/case]
					[case]
						value="Mounted Arcanister"
						[set_variable]
							name=feyn_type
							value="Dwarvish Arcanister TFotC"
						[/set_variable]
					[/case]
				[/switch]
				[unit]
					side=1
					id=Feyndwarf
					type=$feyn_type
					name= _ "Feyndwarf"
					x=$x1
					y=$y1
					experience=$stored_mfeyn.experience
					hitpoints=$mfeyn_hitpoints
					max_hitpoints="$($stored_mfeyn.max_hitpoints-12)"
					moves=0
					attacks_left=$stored_mfeyn.attacks_left
					role=$stored_mfeyn.role
					overlays=$stored_mfeyn.overlays
					{IS_HERO}
				[/unit]
				[modify_unit]
					[filter]
						id=Richard
					[/filter]
					moves="$($stored_mfeyn.moves-1)"
					hitpoints=$stored_richard.hitpoints
					attacks_left=$stored_mfeyn.attacks_left
				[/modify_unit]
				[set_variable]
					name=mounted_feyn
					value=0
				[/set_variable]
			[/command]
		[/set_menu_item]
	[/event]
#enddef
#define HARRIETT_TELEPORTING
[event]
	name=moveto
	first_time_only=no
	[filter]
		side=1
		[filter_adjacent]
			id=Harriett Porter
		[/filter_adjacent]
	[/filter]
	[store_unit]
		[filter]
			id=Harriett Porter
		[/filter]
		variable=stored_harriett
		mode=replace
		kill=no
	[/store_unit]
	[if]
		[variable]
			name=stored_harriett.moves
			numerical_equals=$stored_harriett.max_moves
		[/variable]
		[then]
			[set_variable]
				name=harriett_tele_possible
				value=1
			[/set_variable]
			[set_menu_item]
				id=harriett_tele_unitchoose
				description= _ "Teleport this unit"
				[show_if]
					[variable]
						name=harriett_tele_possible
						equals=1
					[/variable]
				[/show_if]
				[filter_location]
					[filter]
						[filter_adjacent]
							id=Harriett Porter
						[/filter_adjacent]
					[/filter]
				[/filter_location]
				[command]
					[set_variable]
						name=harriett_tele_rdy
						value=1
					[/set_variable]
					[set_variable]
						name=harriett_tele_possible
						value=0
					[/set_variable]
					[modify_unit]
						[filter]
							id=Harriett Porter
						[/filter]
						moves=0
					[/modify_unit]
					[store_unit]
						[filter]
							x=$x1
							y=$y1
						[/filter]
						variable=teleportable_unit
						mode=replace
					[/store_unit]
				[/command]
			[/set_menu_item]
			[set_menu_item]
				id=harriett_tele_locchoose
				description= _ "Teleport unit to this location"
				[show_if]
					[variable]
						name=harriett_tele_rdy
						equals=1
					[/variable]
				[/show_if]
				[filter_location]
					terrain="*^V*"
					owner_side=1
					[not]
						[filter]
						[/filter]
					[/not]
				[/filter_location]
				[command]
					[hide_unit]
						id=$teleportable_unit.id
					[/hide_unit]
					[item]
						x,y=$teleportable_unit.x,$teleportable_unit.y
						halo=halo/har-teleport-xl.png:200,halo/har-teleport-l.png:200,halo/har-teleport-m.png:200,halo/har-teleport-s.png:200
					[/item]
					[remove_item]
						x,y=$teleportable_unit.x,$teleportable_unit.y
						image=halo/har-teleport-xl.png:200,halo/har-teleport-l.png:200,halo/har-teleport-m.png:200,halo/har-teleport-s.png:200
					[/remove_item]
					{TELEPORT_UNIT (id="$teleportable_unit.id") $x1 $y1}
					[delay]
						time=200
					[/delay]
					[item]
						x,y=$x1,$y1
						halo=halo/har-teleport-s.png:200,halo/har-teleport-m.png:200,halo/har-teleport-l.png:200,halo/har-teleport-xl.png:200
					[/item]
					[remove_item]
						x,y=$x1,$y1
						image=halo/har-teleport-s.png:200,halo/har-teleport-m.png:200,halo/har-teleport-l.png:200,halo/har-teleport-xl.png:200
					[/remove_item]
					[unhide_unit]
						id=$teleportable_unit.id
					[/unhide_unit]
					[set_variable]
						name=harriett_tele_rdy
						value=0
					[/set_variable]
				[/command]
			[/set_menu_item]
			[set_menu_item]
				id=harriett_tele_back
				description= _ "Cancel teleporting mode"
				[show_if]
					[variable]
						name=harriett_tele_rdy
						equals=1
					[/variable]
				[/show_if]
				[command]
					[set_variable]
						name=harriett_tele_possible
						value=1
					[/set_variable]
					[set_variable]
						name=harriett_tele_rdy
						value=0
					[/set_variable]
					[modify_unit]
						[filter]
							id=Harriett Porter
						[/filter]
						moves=$stored_harriett.max_moves
					[/modify_unit]
				[/command]
			[/set_menu_item]
		[/then]
	[/if]
[/event]
[event]
	name=turn end
	first_time_only=no
	{VARIABLE harriett_tele_rdy 0}
[/event]
#enddef